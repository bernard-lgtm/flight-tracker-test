<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYT Style: Foreign Trip Visualization</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* --- NYT TYPOGRAPHY & RESET --- */
        body { 
            margin: 0; 
            padding: 0; 
            font-family: 'Georgia', 'Times New Roman', Times, serif; 
            background: #fdfdfd; 
            color: #121212; 
            overflow: hidden; 
        }

        h1, h2, h3 { margin: 0; font-weight: 700; letter-spacing: -0.5px; }
        
        /* Utility for Sans-Serif Data */
        .sans-serif { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; }

        #map { height: 100vh; width: 100vw; z-index: 1; background: #e0e0e0; }

        /* --- LAYOUT CARDS --- */
        .nyt-card {
            position: absolute;
            z-index: 1000;
            background: #ffffff;
            border: 1px solid #ccc;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
        }

        /* Top Left: The Narrative Box */
        #story-container {
            top: 20px;
            left: 20px;
            width: 340px;
            border-top: 4px solid #000; /* Strong editorial header line */
        }

        .kicker {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            color: #a81817; /* NYT Red */
            margin-bottom: 8px;
            display: block;
        }

        .headline {
            font-size: 1.6rem;
            line-height: 1.1;
            margin-bottom: 12px;
            color: #000;
        }

        .date-line {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            font-style: italic;
        }

        .story-text {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #333;
        }

        .flight-info {
            background: #f0f0f0;
            padding: 8px 10px;
            margin-top: 10px;
            border-left: 3px solid #666;
            font-size: 0.85rem;
        }

        /* Top Right: The Data Ticker */
        #cost-container {
            top: 20px;
            right: 20px;
            text-align: right;
            border-bottom: 4px solid #000;
            padding: 15px 20px;
        }

        .metric-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #666;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #121212;
            font-variant-numeric: tabular-nums; /* Monospaced numbers */
        }

        /* Bottom: Timeline Control */
        #controls-container {
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            max-width: 600px;
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            border-radius: 40px; /* Pill shape */
        }

        /* Custom Button */
        .play-btn {
            background: #121212;
            color: #fff;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: background 0.2s;
        }
        .play-btn:hover { background: #333; }
        
        /* Custom Slider */
        input[type=range] {
            flex-grow: 1;
            -webkit-appearance: none;
            background: transparent;
        }
        input[type=range]:focus { outline: none; }
        
        /* Slider Track */
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 2px;
            background: #ccc;
            cursor: pointer;
        }
        
        /* Slider Thumb */
        input[type=range]::-webkit-slider-thumb {
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #a81817;
            border: 2px solid #fff;
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -7px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .timeline-year {
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
            min-width: 40px;
            text-align: right;
        }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            #story-container { width: auto; left: 10px; right: 10px; top: 10px; }
            #cost-container { top: auto; bottom: 80px; right: 10px; border-bottom: none; border-top: 4px solid #000; padding: 10px; }
            #controls-container { width: 90%; bottom: 15px; }
            .headline { font-size: 1.3rem; }
            .metric-value { font-size: 1.4rem; }
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <div id="story-container" class="nyt-card">
        <span class="kicker sans-serif">The Investigation</span>
        <div class="headline">Mapping the Foreign Trips</div>
        <div class="date-line" id="info-date">2014 — 2017</div>
        
        <div class="story-text" id="info-desc">
            An analysis of flight logs reveals a timeline of international travel.
            <br><br>
            <span style="color:#888; font-size:0.9em;">Click the play button below to begin the visualization.</span>
        </div>
    </div>

    <div id="cost-container" class="nyt-card">
        <div class="metric-label sans-serif">Cumulative Expenditure</div>
        <div class="metric-value sans-serif" id="total-spent">R 0</div>
    </div>

    <div id="controls-container" class="nyt-card">
        <button id="play-btn" class="play-btn">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="white"><path d="M8 5v14l11-7z"/></svg>
        </button>
        <input type="range" id="timeline-slider" min="-1" max="0" value="-1" step="1">
        <span class="timeline-year sans-serif" id="timeline-date-display">Start</span>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- DATASET ---
        const trips = [
            { date: "2014-06-08", dest: "United States, United Kingdom", coords: [40.7128, -74.0060], cost: 75000, flight: "SA203", details: "JHB to New York, returning via London." },
            { date: "2014-08-31", dest: "Tanzania", coords: [-6.7924, 39.2083], cost: 28000, flight: "SA186", details: "Regional travel to Dar es Salaam." },
            { date: "2014-09-13", dest: "China & Hong Kong", coords: [1.3521, 103.8198], cost: 11500, flight: "SQ479", details: "Travel via Singapore to Hong Kong." },
            { date: "2014-10-05", dest: "Germany & USA", coords: [50.1109, 8.6821], cost: 16000, flight: "LH573", details: "Frankfurt connection en route to New York." },
            { date: "2014-11-22", dest: "United Kingdom", coords: [51.5074, -0.1278], cost: 18000, flight: "BA54", details: "Direct travel to London." },
            { date: "2014-12-02", dest: "Mauritius & China", coords: [-20.3484, 57.5522], cost: 17100, flight: "MK852", details: "Multi-leg trip involving Mauritius and Hong Kong." },
            { date: "2015-01-17", dest: "Germany", coords: [50.1109, 8.6821], cost: 21500, flight: "LH573", details: "Return trip to Frankfurt." },
            { date: "2015-02-05", dest: "Brazil", coords: [-23.5505, -46.6333], cost: 7100, flight: "SA222", details: "Travel to Sao Paulo." },
            { date: "2015-06-29", dest: "United Kingdom (Wimbledon)", coords: [51.5074, -0.1278], cost: 236000, flight: "SA236", details: "High cost attributed to tickets (R117k)." },
            { date: "2015-09-12", dest: "Germany", coords: [50.1109, 8.6821], cost: 36300, flight: "SA260", details: "Standard travel to Frankfurt." },
            { date: "2015-10-01", dest: "United States", coords: [40.7128, -74.0060], cost: 134000, flight: "SA203", details: "Direct return flight to New York." },
            { date: "2015-11-04", dest: "United Kingdom", coords: [51.5074, -0.1278], cost: 5000, flight: "SA234", details: "Short duration trip to London." },
            { date: "2016-03-30", dest: "Tanzania & UAE", coords: [25.2048, 55.2708], cost: 46800, flight: "SA186", details: "Dar es Salaam continuing to Dubai." },
            { date: "2016-05-25", dest: "UK & USA", coords: [51.5074, -0.1278], cost: 83100, flight: "BA054", details: "London leg of a multi-destination trip." },
            { date: "2016-07-07", dest: "USA (via West Africa)", coords: [40.7128, -74.0060], cost: 38000, flight: "SA207", details: "Route via Dakar and Accra." },
            { date: "2016-09-09", dest: "United States (Atlanta)", coords: [33.7490, -84.3880], cost: 42900, flight: "DL201", details: "Travel to Atlanta, Georgia." },
            { date: "2016-10-10", dest: "India", coords: [28.6139, 77.2090], cost: 31600, flight: "EY603", details: "Abu Dhabi connection to Delhi." },
            { date: "2017-10-14", dest: "Mozambique", coords: [-25.9692, 32.5732], cost: 4750, flight: "SA142", details: "Regional flight to Maputo." }
        ];

        const HOME_COORDS = [-26.2041, 28.0473];

        // --- MAP SETUP (NYT STYLE) ---
        // Using CartoDB Positron for that clean, journalistic greyscale look
        const map = L.map('map', {
            zoomControl: false,
            attributionControl: false, // Hiding for pure aesthetic, usually kept in footer
            scrollWheelZoom: false 
        }).setView([20, 0], 2);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        // Home Marker (Neutral Grey)
        L.circleMarker(HOME_COORDS, {
            color: '#333', fillColor: '#333', fillOpacity: 1, radius: 4
        }).addTo(map);

        // --- CONTROLS & LOGIC ---
        const slider = document.getElementById('timeline-slider');
        const playBtn = document.getElementById('play-btn');
        const dateDisplay = document.getElementById('timeline-date-display');
        const totalSpentDisplay = document.getElementById('total-spent');
        
        const infoDate = document.getElementById('info-date');
        const infoDest = document.getElementById('headline-dest'); // Dynamic Title
        const storyContainer = document.querySelector('#story-container .headline');
        const storyText = document.getElementById('info-desc');

        let isPlaying = false;
        let playInterval;
        let mapLayers = []; 

        slider.max = trips.length - 1;
        
        // Formatter: "R 10,000"
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-ZA', { style: 'currency', currency: 'ZAR', maximumFractionDigits: 0 }).format(amount);
        }

        function clearMapLayers() {
            mapLayers.forEach(layer => map.removeLayer(layer));
            mapLayers = [];
        }

        function renderState(index) {
            clearMapLayers();
            let runningTotal = 0;

            for (let i = 0; i <= index; i++) {
                const trip = trips[i];
                runningTotal += trip.cost;
                const isCurrent = (i === index);
                
                // Line Style: Dashed grey for past, Solid NYT Red implies active route visualization? 
                // Actually, NYT usually does solid black/grey lines.
                const line = L.polyline([HOME_COORDS, trip.coords], {
                    color: isCurrent ? '#a81817' : '#999',
                    weight: isCurrent ? 2 : 1,
                    dashArray: isCurrent ? '' : '3, 6',
                    opacity: isCurrent ? 1 : 0.4
                }).addTo(map);
                mapLayers.push(line);

                // Marker Style: Red dot for current, small grey dot for past
                const marker = L.circleMarker(trip.coords, {
                    color: '#fff', // White stroke
                    weight: 1,
                    fillColor: isCurrent ? '#a81817' : '#999',
                    fillOpacity: isCurrent ? 1 : 0.5,
                    radius: isCurrent ? 6 : 3
                }).addTo(map);
                mapLayers.push(marker);
            }

            totalSpentDisplay.innerText = formatCurrency(runningTotal);
            
            if (index >= 0) {
                const currentTrip = trips[index];
                
                // Narrative Update
                storyContainer.innerText = currentTrip.dest;
                infoDate.innerText = currentTrip.date; // Use a date formatter if desired
                
                storyText.innerHTML = `
                    <div class="flight-info sans-serif">
                        <strong>Flight ${currentTrip.flight}</strong><br/>
                        ${currentTrip.details}
                    </div>
                    <p>Cost for this leg: <strong>${formatCurrency(currentTrip.cost)}</strong></p>
                `;
                
                dateDisplay.innerText = currentTrip.date.split('-')[0]; // Just the Year
                
                if(isPlaying) {
                    const midLat = (HOME_COORDS[0] + currentTrip.coords[0]) / 2;
                    const midLon = (HOME_COORDS[1] + currentTrip.coords[1]) / 2;
                    map.flyTo([midLat, midLon], 2.5, { duration: 1.5, easeLinearity: 0.25 });
                }
            } else {
                // Reset State
                storyContainer.innerText = "Mapping the Foreign Trips";
                infoDate.innerText = "2014 — 2017";
                storyText.innerHTML = `An analysis of flight logs reveals a timeline of international travel.<br><br><span style="color:#888; font-size:0.9em;">Click the play button below to begin.</span>`;
                dateDisplay.innerText = "Start";
                totalSpentDisplay.innerText = "R 0";
                map.flyTo([20, 0], 2);
            }
        }

        function nextStep() {
            let nextVal = parseInt(slider.value) + 1;
            if (nextVal < trips.length) {
                slider.value = nextVal;
                renderState(nextVal);
            } else {
                pause();
            }
        }

        function play() {
            isPlaying = true;
            // Switch Icon to Pause
            playBtn.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="white"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>`;
            
            if (parseInt(slider.value) === trips.length - 1) {
                slider.value = -1;
                renderState(-1);
            }
            playInterval = setInterval(nextStep, 2500); // Slightly slower for readability
        }

        function pause() {
            isPlaying = false;
            // Switch Icon to Play
            playBtn.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="white"><path d="M8 5v14l11-7z"/></svg>`;
            clearInterval(playInterval);
        }

        playBtn.addEventListener('click', () => isPlaying ? pause() : play());
        
        slider.addEventListener('input', (e) => {
            pause();
            renderState(parseInt(e.target.value));
        });

        // Initialize
        renderState(-1);
    </script>
</body>
</html>
